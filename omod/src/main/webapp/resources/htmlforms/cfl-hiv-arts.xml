<htmlform formUuid="ad796f8c-b966-11eb-9ad8-0242ac120002" formName="HIV Program Form"
          formEncounterType="b3af129b-90c9-4f84-966e-f4f9515083e6" formVersion="1.0">

    <style type="text/css">
        /** HTML Forms default styles **/

        #metadata {
            display: none;
        }

        #htmlform {
            font-family: CircularStd;
            display: flex;
            padding: 20px;
            background-color: white;
            border: 1px solid rgba(0, 0, 0, 0.15);
        }

        #htmlform htmlform {
            width: 100%;
        }

        #htmlform htmlform h2 {
            color: #333333;
        }

        #htmlform htmlform h1, h3, h4, h5, h6 {
            color: inherit !important;
        }

        #htmlform htmlform input,
        #htmlform htmlform label {
            margin-top: 0;
            margin-bottom: 0;
        }

        #htmlform htmlform .obs-field {
            align-items: flex-start;
        }

        #htmlform htmlform table {
            margin: 10px 0;
        }

        #htmlform htmlform table tr {
            padding: 5px 0;
            border-top: 1px solid rgba(0, 0, 0, 0.15) !important;
            border-bottom: 1px solid rgba(0, 0, 0, 0.15) !important;
        }

        #htmlform htmlform table td {
            background-color: white !important;
            cursor: default;
            padding: 20px 0;
        }

        #htmlform htmlform table td[style*="display: none;"] {
            display: table-cell !important;
        }

        #htmlform htmlform table td[style*="display: none;"] * {
            display: none;
        }

        #htmlform htmlform .section {
            border: none;
        }

        #htmlform htmlform input,
        #htmlform htmlform select,
        #htmlform htmlform textarea,
        #htmlform htmlform ul.select {
            background-color: white;
        }

        #htmlform htmlform input[type='button'] {
            font-family: CircularStd;
            font-size: 13px !important;
            border: 1px solid #6c757d !important;
            margin-right: 0.75rem !important;
            border-radius: 4px !important;
            line-height: 1.5;
        }

        #htmlform htmlform input.addNewInterruptionButtonClass[type='button'] {
            border-radius: 0px !important;
            padding: 0px 10px !important;
            font-size: 20px !important;
            font-weight: bold;
            height: 35px;
            width: 35px;
        }

        #htmlform htmlform input.removeInterruptionButtonClass[type='button'] {
            border-radius: 0px !important;
            padding: 0px 10px !important;
            font-size: 20px !important;
            font-weight: bold;
            height: 35px;
            width: 35px;
        }

        #htmlform htmlform input.addNewInterruptionButtonIfEmptyClass[type='button'] {
            border-radius: 0px !important;
            padding: 0px 10px !important;
            font-size: 20px !important;
            font-weight: bold;
            height: 35px;
            width: 35px;
            margin-left: 10px;
        }

        #htmlform htmlform input.removeArtButtonClass[type='button'] {
            border-radius: 0px !important;
            padding: 0px 10px !important;
            font-size: 20px !important;
            font-weight: bold;
        }

        #htmlform htmlform button.confirm,
        #htmlform htmlform input.confirm {
            background: #00455c;
            border: 1px solid #6c757d !important;
            font-size: 11px !important;
            text-transform: uppercase;
            color: white !important;
        }

        #htmlform htmlform button.cancel,
        #htmlform htmlform input.cancel {
            background: none !important;
            border: 1px solid #00455c !important;
            color: #00455c !important;
            padding: 8px 20px;
        }

        ul.ui-autocomplete {
            border-radius: 0;
        }

        ul.ui-autocomplete li.ui-menu-item a {
            border-radius: 0;
            border: none;
            margin: -1px;
        }

        ul.ui-autocomplete li.ui-menu-item a.ui-state-focus,
        ul.ui-autocomplete li.ui-menu-item a.ui-state-hover {
            background: #e4e7e7 !important;
        }

        #htmlform htmlform input,
        #htmlform htmlform select {
            color: inherit !important;
            box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075) !important;
        }

        #htmlform htmlform input:focus,
        #htmlform htmlform select:focus {
            outline: none !important;
            border: 1px solid #AEC2D5 !important;
            box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(102, 175, 233, 0.6) !important;
        }

        #ui-datepicker-div {
            color: #2B3640;
        }

        #ui-datepicker-div .ui-datepicker-header {
            background: none;
            border: none;
        }

        #ui-datepicker-div .ui-datepicker-header .ui-datepicker-prev,
        #ui-datepicker-div .ui-datepicker-header .ui-datepicker-next {
            background: none;
            border: none;
        }

        #ui-datepicker-div .ui-datepicker-calendar tr td {
            background: inherit !important;
        }

        #ui-datepicker-div .ui-datepicker-calendar tr td:hover {
            background: inherit !important;
        }

        #ui-datepicker-div .ui-datepicker-calendar tr td a.ui-state-default {
            background: white !important;
        }

        #ui-datepicker-div .ui-datepicker-calendar tr td a.ui-state-hover {
            background: #e4e7e7 !important;
        }

        #ui-datepicker-div .ui-datepicker-calendar tr td a.ui-state-active {
            background: #00455c !important;
            color: white;
        }

        #ui-datepicker-div .ui-datepicker-calendar tr td a.ui-state-highlight {
            border-color: #d3d3d3;
        }

        .patient-header .value {
            color: inherit;
            font-weight: inherit;
        }

        #htmlform htmlform table td.headerRow {
            cursor: pointer;
            width: 23%;
            text-align: center;
        }

        #htmlform htmlform table td.headerRow input,
        #htmlform htmlform table td.headerRow select {
            display: inline-block;
            float: center;
        }

        #htmlform htmlform .error {
            color: red;
        }

        #htmlform htmlform table td.detailsRow {
            text-align: center;
            background-color: #ededed !important;
            cursor: default;
            padding: 20px 0;
        }

        #htmlform htmlform table td.titleRowTd {
            text-align: center;
            background-color: #ededed !important;
            cursor: default;
            padding: 20px 0;
            width: 23%;
        }

        #htmlform htmlform table td.detailsRow input,
        #htmlform htmlform table td.detailsRow select {
            display: inline-block;
            float: center;
        }

        .addNewInterruptionButtonClass {
            font-size: 20px !important;
            padding: 0px 10px !important;
        }

        .removeInterruptionButtonClass {
            font-size: 20px !important;
            padding: 0px 10px !important;
        }

        .removeArtButtonClass {
            font-size: 20px !important;
            padding: 0px 10px !important;
        }

        .noInterruptionsClass {
            justify-content: center;
            align-items: center;
            margin-top: 30px;
        }

        .drugFieldTd {
            text-align: center;
            cursor: default;
            padding: 20px 0;
            width: 23%;
        }

        #regimenDetailsHeaderTable .regimenDetailsHeaderTd {
            text-align: center;
            cursor: default;
            background-color: #ededed !important;
            padding: 20px 0;
            width: 23%;
        }

        #radioDiv label {
            margin-top: -5px !important;
        }

        span.obs-field.customInput > input {
            min-width: 200px;
        }

        #titleDiv {
            margin-bottom: 20px;
            margin-top: -20px;
        }

        .disabledElem {
            background-color: #EAEAEA !important;
        }

        .alignInput {
            margin-top: 20px !important;
        }

    </style>

    <ifMode mode="VIEW" include="false">
        <div id="metadata">
            <p>
                <encounterDate id="encounterDate" default="now" showTime="false"/>
            </p>
            <p>
                <label><uimessage code="coreapps.patientDashBoard.provider"/></label>
                <span><encounterProvider default="currentUser" required="true"  /></span>
            </p>
            <p>
                <label><uimessage code="coreapps.patientDashBoard.location"/></label>
                <span><encounterLocation default="SessionAttribute:emrContext.sessionLocationId"/></span>
            </p>
        </div>

        <span id="regimensInfo" style="display: none;">
            <lookup complexExpression = "
				#set($resultText = '|')
				#foreach($regimen in $regimens)
					#set($resultText = $resultText.concat($regimen.name).concat(':'))
					#foreach($drug in $regimen.regimenDrugs)
						#set($resultText = $resultText.concat($drug.drug.name).concat('_').concat($drug.doseUnits.name).concat('_').concat($drug.dose).concat('_').concat($drug.frequency.name).concat(';'))
					#end
					#set($resultText = $resultText.concat('|'))
				#end
				#set($resultText = $resultText.trim())
				$!{resultText}
			" />
        </span>

        <script type="text/javascript">
            $(document).ready(function() {

                const handleCancelButtonClick = function() {
                    $('#cancelButton').click(() => {
                        var queryParams = new URLSearchParams(window.location.search);
                        if (queryParams.has('patientId')) {
                            window.location.replace("/openmrs/coreapps/clinicianfacing/patient.page?patientId=" + queryParams.get('patientId'));
                        }
                    });
                }

                //executions
                handleCancelButtonClick();
            });

        </script>
    </ifMode>

    <ifMode mode="ENTER">
        <script type="text/javascript">
            beforeSubmit.push(function() {

                var isValidForm = true;

                //validation of HIV ART Date Started in ENTER mode
                var hivArtDateStartedValue = getValue('hivArtDateStarted.value');
                var hivArtDateStartedErrorField = getField('hivArtDateStarted.error');
                hivArtDateStartedErrorField.hide();
                if (hivArtDateStartedValue == null || hivArtDateStartedValue == '') {
                    hivArtDateStartedErrorField.html("Required").show();
                    isValidForm = false;
                }

                //validation of Regimen value in ENTER mode
                var regimenField =  $('#regimenValueTd').find('#regimenValue > select');
                var regimenValue = regimenField.val();
                var regimenErrorField = regimenField.closest('span').find('.error');
                regimenErrorField.hide();
                if (regimenValue == null || regimenValue == '') {
                    regimenErrorField.html("Required").show();
                    isValidForm = false;
                }

                //validation of HIV ART Date Stopped in ENTER mode
                var hivArtDateStoppedValue = getValue('hivArtDateStopped.value');
                var hivArtDateStoppedErrorField = getField('hivArtDateStopped.error');
                hivArtDateStoppedErrorField.hide();
                if (hivArtDateStoppedValue == null || hivArtDateStoppedValue == '') {
                    if (!$('#currentRegimen > input[type="checkbox"]').is(":checked")) {
                        hivArtDateStoppedErrorField.html("Required").show();
                        isValidForm = false;
                    }
                }

                //validation of ART interruption date in ENTER mode
                if ($('#interruptionOptionsTrToHide').is(':visible')) {
                    var artInterruptionDateValue = getValue('artInterruptionDate.value');
                    var artInterruptionErrorField = getField('artInterruptionDate.error');
                    artInterruptionErrorField.hide();
                    if (artInterruptionDateValue == null || artInterruptionDateValue == '') {
                        artInterruptionErrorField.html("Required").show();
                        isValidForm = false;
                    }
                }

                if (isValidForm == false) {
                    return false;
                }

                return true;
            });


            $(document).ready(function() {

                const setCurrentRegimenActiveByDefault = function(selector) {
                    const checkboxSelector = selector + ' > input[type=checkbox]';
                    $(checkboxSelector).prop("checked", true);
                    $('#dateStoppedTd').hide();
                    $('#reasonStoppedTd').hide();
                }

                const addTogglingFieldsVisibilityToCurrentRegimentCheckbox = function(selector) {
                    const checkboxSelector = selector + ' > input[type=checkbox]';
                    const isCheckedSelector = checkboxSelector + ':checked';
                    const toggleInputVisibility = function() {
                    if ($(isCheckedSelector).length) {
                        $('#dateStoppedTd').hide();
                        $('#reasonStoppedTd').hide();
                    } else {
                        $('#dateStoppedTd').show();
                        $('#reasonStoppedTd').show();
                        }
                    }
                    $(checkboxSelector).click(() => toggleInputVisibility());
                }

                const addTogglingFieldsVisibilityToArtInterruptionsRadioButton = function() {
                    $('#radioDiv > input[type=radio]').click(function() {
                        if ($(this).val() === "true") {
                            $('#interruptionOptionsTrToHide').show();
                            $('#interruptionOptionsTrToHide').show();
                        } else if ($(this).val() === "false") {
                            $('#interruptionOptionsTrToHide').hide();
                            $('#interruptionOptionsTrToHide').hide();
                        }
                    });
                }

                const setARTInterruptionsHiddenByDefault = function() {
                    $('#interruptionOptionsDiv > input[type=radio]').prop( "checked", true );
                    $('#interruptionOptionsTrToHide').hide();
                    $('#interruptionOptionsTrToHide').hide();
                }

                const handleOnChange = function(field) {
                    $('#' + field).change(function () {
                        var fieldValue = getValue(field + '.value');
                        var errorField = getField(field + '.error');
                        if (fieldValue == null || fieldValue == '') {
                            errorField.html("Required").show();
                            $('#' + field).parent().addClass("alignInput");
                        } else {
                            errorField.hide();
                            $('#' + field).parent().removeClass("alignInput");
                        }
                    })
                }

                const handleRegimenChange = function(field) {
                    $(field).change(function () {
                        var selectedValue = $(this).val();
                        var regimensInfo = $('#regimensInfo').text().trim();
                        var splittedRegimens = regimensInfo.split('|');
                        $('#regimenDetailsTable').empty();
                        var regimenField =  $('#regimenValueTd').find('#regimenValue > select');
                        var regimenErrorField = regimenField.closest('span').find('.error');
                        if (selectedValue != '') {
                            for (var i = 0; i &lt; splittedRegimens.length; i++) {
                            var splittedRegimenDetails = splittedRegimens[i].split(':');
                                if (splittedRegimenDetails[0] == selectedValue) {
                                    var splittedRegimenDrugDetails = splittedRegimenDetails[1].split(';');
                                    for (var j=0; j &lt; splittedRegimenDrugDetails.length; j++) {
                                        var splittedRegimenDrugDetailsObject = splittedRegimenDrugDetails[j];
                                        if (splittedRegimenDrugDetailsObject.length != 0) {
                                            var drugFields = splittedRegimenDrugDetailsObject.split('_');
                                            $('#regimenDetailsTable').append('<tr><td class="drugFieldTd">' + drugFields[0] + '</td><td class="drugFieldTd">' + drugFields[1] + '</td><td class="drugFieldTd">' + drugFields[2] + '</td><td class="drugFieldTd">' + drugFields[3] + '</td></tr>');
                                        }
                                    }
                                }
                            }
                            $('#regimenDetailsDiv').show();
                            regimenErrorField.html("Required").hide();
                        } else {
                            $('#regimenDetailsDiv').hide();
                            regimenErrorField.html("Required").show();
                        }
                    })
                }

                //executions
                setCurrentRegimenActiveByDefault('#currentRegimen');
                addTogglingFieldsVisibilityToCurrentRegimentCheckbox('#currentRegimen');
                setARTInterruptionsHiddenByDefault();
                addTogglingFieldsVisibilityToArtInterruptionsRadioButton();
                handleOnChange('hivArtDateStarted');
                handleOnChange('hivArtDateStopped');
                handleRegimenChange('#regimenValue > select');
                handleOnChange('artInterruptionDate');
            });
        </script>

        <div id="titleDiv">
            <h2 style="color: blue;">
                <uimessage code="HIV - Add ART"/>
            </h2>
        </div>

        <obsgroup groupingConceptId="7e08e42b-744c-4a33-8a59-e0ec735ffd59">
            <table>
                <lookup expression="fn.getConcept('20fb8dc4-b958-4c88-b9a7-96ea36b4b0ef').name"/><obs id="currentRegimen" conceptId="20fb8dc4-b958-4c88-b9a7-96ea36b4b0ef" style="checkbox"/><b/>
                <tr>
                    <td class="datePickerField"><div><lookup expression="fn.getConcept('ddfdf4fa-1d0a-40ca-8930-ad914bd07b23').name"/><span style="color:red">*</span><obs id="hivArtDateStarted" conceptId="ddfdf4fa-1d0a-40ca-8930-ad914bd07b23" allowFutureDates="false" allowTime="false" defaultObsDatetime="now" class="customInput" /></div></td>
                    <td id="dateStoppedTd" class="datePickerField"><div><lookup expression="fn.getConcept('806195ad-9f5c-42f0-ad9f-736a21a1dac1').name"/><span style="color:red">*</span><obs id="hivArtDateStopped" conceptId="806195ad-9f5c-42f0-ad9f-736a21a1dac1" allowFutureDates="false" allowTime="false" defaultObsDatetime="now" class="customInput"/></div></td>
                    <td id="reasonStoppedTd"><div><lookup expression="fn.getConcept('9c65e0a7-8c12-46d4-8ad2-da1aa37b8276').name"/><obs id="hivArtReasonStopped" conceptId="9c65e0a7-8c12-46d4-8ad2-da1aa37b8276" defaultObsDatetime="now" class="customInput"/></div></td>
                </tr>
                <tr>
                    <td id="regimenValueTd"><div><span class="left"><lookup expression="fn.getConcept('c7e17ce8-d832-4349-a326-b20f5ae7f432').name"/></span><span style="color:red">*</span><br></br><span id="regimenValue"><regimen conceptId="c7e17ce8-d832-4349-a326-b20f5ae7f432" addNew="false"/></span></div></td>
                    <td><div><span class="left"><lookup expression="fn.getConcept('324f28ab-cfa7-46ac-99f3-c7d928ba5e79').name"/></span><br></br><obs id="artType" conceptId="324f28ab-cfa7-46ac-99f3-c7d928ba5e79" defaultObsDatetime="now"/></div></td>
                </tr>
            </table>

            <div id="regimenDetailsDiv" style="display: none;">
                <div id="regimenDetailsHeaderDiv">
                    <table id="regimenDetailsHeaderTable">
                        <tr id="regimenDetailsHeaderTr">
                            <td class="regimenDetailsHeaderTd">Drug name</td>
                            <td class="regimenDetailsHeaderTd">Dose unit</td>
                            <td class="regimenDetailsHeaderTd">Number of units</td>
                            <td class="regimenDetailsHeaderTd">Frequency</td>
                        </tr>
                    </table>
                </div>
                <div>
                    <table id="regimenDetailsTable"></table>
                </div>
            </div>
            <br></br>

            <table>
                <tr id="interruptionOptionsTr">
                    <td><div id="interruptionOptionsDiv"><span class="left"><lookup expression="fn.getConcept('ecab0816-0f06-47cd-aa4d-68f428a26f3f').name"/></span>
                        <br></br>
                        <br></br>
                        <div id="radioDiv" style="display: flex;"><obs conceptId="ecab0816-0f06-47cd-aa4d-68f428a26f3f" style="yes_no" defaultObsDatetime="now" /></div></div>
                    </td>
                </tr>
                <tr id="interruptionOptionsTrToHide">
                    <td><div><span class="left"><lookup expression="fn.getConcept('dca99985-a303-4418-a440-d2af44f62c4b').name"/></span><span style="color:red">*</span><br></br><obs id="artInterruptionDate" conceptId="dca99985-a303-4418-a440-d2af44f62c4b" allowFutureDates="false" allowTime="false" class="customInput" /></div></td>
                    <td><div><span class="left"><lookup expression="fn.getConcept('30d09891-6bae-492c-b45b-ebe142837497').name"/></span><br></br><obs id="artInterruptionReason" conceptId="30d09891-6bae-492c-b45b-ebe142837497" class="customInput"/></div></td>
                    <td><div><span class="left"><lookup expression="fn.getConcept('d9cd2810-d600-47c4-b29c-234c72514b9e').name"/></span><br></br><obs id="artRestartDate" conceptId="d9cd2810-d600-47c4-b29c-234c72514b9e" allowFutureDates="false" allowTime="false" class="customInput"/></div></td>
                </tr>
            </table>
        </obsgroup>
        <br></br>
        <br></br>
    </ifMode>

    <ifMode mode="EDIT">
        <script type="text/javascript">
            beforeSubmit.push(function() {

                var isValidForm = true;

                // validation of ART interruption date fields in EDIT mode
                for (i = 1; i &lt; 11; i++) {
                    for (j = 1; j &lt; 11; j++) {
                        var interruptionRowElem = $('#' + i + '-' + j + '-mainRowInterruption:visible');
                        if (interruptionRowElem.length) {
                            var artInterruptionDateValue = getValue(i + '-' + j + '-interruptionDate.value');
                            var artInterruptionDateErrorField = getField(i + '-' + j + '-interruptionDate.error');
                            artInterruptionDateErrorField.hide();
                            if (artInterruptionDateValue == null || artInterruptionDateValue == '') {
                                artInterruptionDateErrorField.html("Required").show();
                                if (!artInterruptionDateErrorField.prev().is('br')) {
                                    $('<br></br>').insertBefore(artInterruptionDateErrorField);
                                }
                                isValidForm = false;
                            }
                        }
                    }
                }

                // validation of ART main fields (HIV ART Date Started, HIV ART Date Stopped, Regimen) in EDIT mode
                for (i = 1; i &lt; 11; i++) {
                    //HIV ART Date Started validation
                    var hivArtDateStartedValue = getValue(i + '-ARTDateStarted.value');
                    var hivArtDateStartedErrorField = getField(i + '-ARTDateStarted.error');
                    hivArtDateStartedErrorField.hide();
                    if (($('#' + i + '-ART:visible').length) &amp;&amp; (hivArtDateStartedValue == null || hivArtDateStartedValue == '')) {
                        hivArtDateStartedErrorField.html("Required").show();
                        if (!hivArtDateStartedErrorField.prev().is('br')) {
                            $('<br></br>').insertBefore(hivArtDateStartedErrorField);
                        }
                        isValidForm = false;
                    }

                    //Regimen value validation
                    var hivRegimenField = $('#' + i + '-regimenSpan select');
                    var hivRegimenValue = hivRegimenField.val();
                    var spanError = hivRegimenField.closest('span').find('.error');
                    spanError.hide();
                    if (($('#' + i + '-ART:visible').length) &amp;&amp; (hivRegimenValue == null || hivRegimenValue == '')) {
                        spanError.html("Required").show();
                        if (!spanError.prev().is('br')) {
                            $('<br></br>').insertBefore(spanError);
                        }
                        isValidForm = false;
                    }

                    //HIV ART Date Stopped validation
                    if (getValue(i + '-currentRegimen.value') == null) {
                        var hivArtDateStoppedValue = getValue(i + '-ARTDateStopped.value');
                        var hivArtDateStoppedErrorField = getField(i + '-ARTDateStopped.error');
                        hivArtDateStoppedErrorField.hide();
                        if (($('#' + i + '-ART:visible').length) &amp;&amp; (hivArtDateStoppedValue == null || hivArtDateStoppedValue == '')) {
                            hivArtDateStoppedErrorField.html("Required").show();
                            if (!hivArtDateStoppedErrorField.prev().is('br')) {
                                $('<br></br>').insertBefore(hivArtDateStoppedErrorField);
                            }
                            isValidForm = false;
                        }
                    }
                }

                //Add new ART form validation in EDIT mode
                if ($('#addNewArtDiv').is(':visible')) {
                    //validation of HIV ART Date Started in EDIT mode
                    var hivArtDateStartedValue = getValue('artDateStartedInEditMode.value');
                    var hivArtDateStartedErrorField = getField('artDateStartedInEditMode.error');
                    hivArtDateStartedErrorField.hide();
                    if (hivArtDateStartedValue == null || hivArtDateStartedValue == '') {
                        hivArtDateStartedErrorField.html("Required").show();
                        isValidForm = false;
                    }

                    //validation of Regimen value in EDIT mode
                    var regimenField =  $('#regimenValueTd').find('#regimenValue > select');
                    var regimenValue = regimenField.val();
                    var regimenErrorField = regimenField.closest('span').find('.error');
                    regimenErrorField.hide();
                    if (regimenValue == null || regimenValue == '') {
                        regimenErrorField.html("Required").show();
                        isValidForm = false;
                    }

                    //validation of HIV ART Date Stopped in EDIT mode
                    var hivArtDateStoppedValue = getValue('artDateStoppedInEditMode.value');
                    var hivArtDateStoppedErrorField = getField('artDateStoppedInEditMode.error');
                    hivArtDateStoppedErrorField.hide();
                    if (hivArtDateStoppedValue == null || hivArtDateStoppedValue == '') {
                        if (!$('#currentRegimenForNewArt > input[type="checkbox"]').is(":checked")) {
                            hivArtDateStoppedErrorField.html("Required").show();
                            isValidForm = false;
                        }
                    }

                    //validation of ART interruption date in EDIT mode
                    if ($('#interruptionOptionsTrToHide').is(':visible')) {
                        var artInterruptionDateValue = getValue('artInterruptionDateInEditMode.value');
                        var artInterruptionErrorField = getField('artInterruptionDateInEditMode.error');
                        artInterruptionErrorField.hide();
                        if (artInterruptionDateValue == null || artInterruptionDateValue == '') {
                            artInterruptionErrorField.html("Required").show();
                            isValidForm = false;
                        }
                    }
                }

                if (isValidForm == false) {
                    return false;
                }

                return true;
            });

            $(document).ready(function() {

                const handleAddNewArtButton = function() {
                    $('#addNewArtButton').click(() => {
                        $('#addNewArtDiv').slideToggle();
                        $('html, body').animate({
                            scrollTop: $("#buttons").offset().top
                        }, 1000);
                    });
                }

                const handleAccordionForARTDetails = function() {
                    $('.artTableClass').find('tr.mainRowARTClass').click(function() {
                        var elemId = $(this).attr('id');
                        var currentId = parseFloat(elemId);
                        var isEmptyInterruptions = true;
                        if ($('#' + currentId + '-headerRowInterruption:visible').length ||
                            $('#' + currentId + '-noInterruptionsRow:visible').length) {
                            for (j = 1; j &lt; 11; j++) {
                                if(j &lt; 10) {
                                    var fieldValue = getValue(currentId + '-' + j + '-interruptionDate.value');
                                    var nextId = j + 1;
                                    var nextFieldValue = getValue(currentId + '-' + nextId + '-interruptionDate.value');
                                    if (nextFieldValue) {
                                        $('#' + currentId + '-' + j + '-addInterruptionButton').hide();
                                    } else {
                                        $('#' + currentId + '-' + j + '-addInterruptionButton').show();
                                    }
                                }
                            }
                                $('#' + currentId + '-headerRowInterruption').slideUp();
                                $('.' + currentId + '-mainRowInterruptionClass').slideUp();
                                $('#' + currentId + '-noInterruptionsRow').hide();
                        } else {
                                for(i = 1; getValue(currentId + '-' + i + '-interruptionDate.value') &amp;&amp; i &lt; 11; i++) {
                                    isEmptyInterruptions = false;
                                    $('#' + currentId + '-headerRowInterruption').slideDown();
                                    $('#' + currentId + '-' + i + '-mainRowInterruption').show();
                                }
                                if (isEmptyInterruptions == true) {
                                        $('#' + currentId + '-noInterruptionsRow').show();
                                        $('#' + currentId + '-noInterruptionsRow').css('display', 'flex');
                                }
                        }
                    });
                }

                const showActiveARTs = function() {
                    for (i=1; i &lt; 11; i++) {
                        var fieldValue = getValue(i + '-ARTDateStarted.value');
                        if (fieldValue) {
                            var currentArtDiv = $('#' + i + '-ART');
                            currentArtDiv.show();
                            if (getValue(i + '-currentRegimen.value') != null) {
                                var artDateStoppedElement = $('#' + i + '-ARTDateStopped input');
                                artDateStoppedElement.prop("disabled", true);
                                artDateStoppedElement.val("");
                                artDateStoppedElement.addClass("disabledElem");
                                currentArtDiv.insertBefore($('#1-ART'))
                            }
                        }
                    }
                }

                const showOrHideAddInterruptionsButtons = function() {
                    for (i = 1; i &lt; 11; i++) {
                        for (j = 1; j &lt; 11; j++) {
                            if(j &lt; 10) {
                                var fieldValue = getValue(i + '-' + j + '-interruptionDate.value');
                                var nextId = j + 1;
                                var nextFieldValue = getValue(i + '-' + nextId + '-interruptionDate.value');
                                if (nextFieldValue) {
                                    $('#' + i + '-' + j + '-addInterruptionButton').hide();
                                } else {
                                    $('#' + i + '-' + j + '-addInterruptionButton').show();
                                }
                            }
                        }
                    }
                }

                const handleAddNewInterruptionButtonClick = function() {
                    $('input.addNewInterruptionButtonClass').click(function() {
                    var clickedElemId = this.id;
                    $('#' + clickedElemId).hide();
                    var artId = parseFloat(clickedElemId);

                    var startPosition = clickedElemId.indexOf('-') + 1;
                    var croppedElemId = clickedElemId.substring(startPosition);
                    var currentId = parseFloat(croppedElemId);
                    var nextId = currentId + 1;
                    var htmlElementToShow = '#' + artId + '-' + nextId + '-mainRowInterruption';
                    $('#' + artId + '-' + nextId + '-addInterruptionButton').show();
                    $('#' + artId + '-' + nextId + '-removeInterruptionButton').show();
                    $(htmlElementToShow).show();

                    $('html, body').animate({
                        scrollTop: $(htmlElementToShow).offset().top
                    }, 1000);
                    });
                }

                const handleAddNewInterruptionIfEmptyButtonClick = function() {
                    $('input.addNewInterruptionButtonIfEmptyClass').click(function() {
                        var clickedElemId = this.id;
                        var artId = parseFloat(clickedElemId);
                        $('#' + artId + '-noInterruptionsRow').hide();
                        $('#' + artId + '-headerRowInterruption').show();
                        $('#' + artId + '-1' + '-addInterruptionButton').show();
                        $('#' + artId + '-1' + '-removeInterruptionButton').show();
                        $('#' + artId + '-1' + '-mainRowInterruption').show();

                        return false;
                    });
                }

                const handleRemoveARTButtonClick = function() {
                    $('input.removeArtButtonClass').click(function() {
                        var clickedElemId = this.id;
                        var prefixId = parseFloat(clickedElemId);
                        setValue(prefixId + '-ARTDateStarted.value', "");
                        $('#' + prefixId + '-ART').hide();
                    });
                }

                const handleRemoveInterruptionClick = function() {
                    $('input.removeInterruptionButtonClass').click(function() {
                        var clickedElemId = this.id;
                        var artId = parseFloat(clickedElemId);
                        var startPosition = clickedElemId.indexOf('-') + 1;
                        var extractedInterruptionIdWithoutArtId = clickedElemId.substring(startPosition);
                        var interruptionId = parseFloat(extractedInterruptionIdWithoutArtId);
                        setValue(artId + '-' + interruptionId + '-interruptionDate.value', "");
                        setValue(artId + '-' + interruptionId + '-interruptionReason.value', "");
                        setValue(artId + '-' + interruptionId + '-interruptionRestartDate.value', "");
                        $('#' + artId + '-' + interruptionId + '-mainRowInterruption').hide();

                        var nextInterruptionTr = $('#' + artId + '-' + interruptionId + '-mainRowInterruption').nextAll('tr:visible').first();
                        if (nextInterruptionTr.length == 0) {
                            var previousInterruptionTr = $('#' + artId + '-' + interruptionId + '-mainRowInterruption').prevAll('tr:visible').first();
                            var previousInterruptionTrId = previousInterruptionTr.attr('id');
                            var extractedInterruptionIdWithoutArtId = previousInterruptionTrId.substring(previousInterruptionTrId.indexOf('-') + 1);
                            var interruptionId = parseFloat(extractedInterruptionIdWithoutArtId);
                            $('#' + artId + '-' + interruptionId + '-addInterruptionButton').show();
                        }

                        var isVisibleAnyInterruptionRow = false;
                        for (i = 1; i &lt; 11; i++) {
                            if ($('#' + artId + '-' + i + '-mainRowInterruption').is(':visible')) {
                                isVisibleAnyInterruptionRow = true;
                            }
                        }

                        if (!isVisibleAnyInterruptionRow) {
                            $('#' + artId + '-headerRowInterruption').hide();
                            $('#' + artId + '-noInterruptionsRow').show();
                        }
                    });
                }

                const setBreadcrumbsUrl = function() {
                    var queryParams = new URLSearchParams(window.location.search);
                    if (queryParams.has('patientId')) {
                        $('#breadcrumbs li:nth-child(2) a[href]').attr("href", "/openmrs/coreapps/clinicianfacing/patient.page?patientId=" + queryParams.get('patientId'));
                    }
                }

                const handleTogglingCurrentRegimenCheckbox = function() {
                    $('.currentRegimenCheckbox').click(function(event) {
                        var checkboxId = event.target.id;
                        var parentId = $('#' + checkboxId).parent().attr('id');
                        var rowNumber = parentId.substr(0, parentId.indexOf('-'));
                        var artDateStoppedElement = $('#' + rowNumber + '-ARTDateStopped input');
                        if ($('#' + checkboxId).is(":checked")) {
                            artDateStoppedElement.prop("disabled", true);
                            artDateStoppedElement.val("");
                            artDateStoppedElement.addClass("disabledElem");
                        } else {
                            artDateStoppedElement.prop("disabled", false);
                            artDateStoppedElement.removeClass("disabledElem");
                        }
                    });
                }

                const handleOnChange = function(field) {
                    $('#' + field).change(function () {
                        var fieldValue = getValue(field + '.value');
                        var errorField = getField(field + '.error');
                        if (fieldValue == null || fieldValue == '') {
                            errorField.html("Required").show();
                            $('#' + field + ' > input').first().addClass("alignInput");
                            if (!errorField.prev().is('br')) {
                                $('<br></br>').insertBefore(errorField);
                            }
                        } else {
                            errorField.hide();
                            $('#' + field + ' > input').first().removeClass("alignInput");
                        }
                    })
                }

                const handleRegimenChange = function(field) {
                    $(field).change(function () {
                        var selectedValue = $(this).val();
                        var regimensInfo = $('#regimensInfo').text().trim();
                        var splittedRegimens = regimensInfo.split('|');
                        $('#regimenDetailsTable').empty();
                        var regimenField =  $('#regimenValueTd').find('#regimenValue > select');
                        var regimenErrorField = regimenField.closest('span').find('.error');
                        if (selectedValue != '') {
                            for (var i = 0; i &lt; splittedRegimens.length; i++) {
                                var splittedRegimenDetails = splittedRegimens[i].split(':');
                                if (splittedRegimenDetails[0] == selectedValue) {
                                    var splittedRegimenDrugDetails = splittedRegimenDetails[1].split(';');
                                    for (var j=0; j &lt; splittedRegimenDrugDetails.length; j++) {
                                        var splittedRegimenDrugDetailsObject = splittedRegimenDrugDetails[j];
                                        if (splittedRegimenDrugDetailsObject.length != 0) {
                                            var drugFields = splittedRegimenDrugDetailsObject.split('_');
                                            $('#regimenDetailsTable').append('<tr><td class="drugFieldTd">' + drugFields[0] + '</td><td class="drugFieldTd">' + drugFields[1] + '</td><td class="drugFieldTd">' + drugFields[2] + '</td><td class="drugFieldTd">' + drugFields[3] + '</td></tr>');
                                        }
                                    }
                                }
                            }
                            $('#regimenDetailsDiv').show();
                            regimenErrorField.html("Required").hide();
                        } else {
                            $('#regimenDetailsDiv').hide();
                            regimenErrorField.html("Required").show();
                        }
                    })
                }

                //FUNCTIONS FOR ADD ART IN EDIT MODE
                const setCurrentRegimentActiveByDefault = function(selector) {
                    const checkboxSelector = selector + ' > input[type=checkbox]';
                    $(checkboxSelector).prop("checked", false);
                    $('#dateStoppedTd').show();
                    $('#reasonStoppedTd').show();
                }

                const addTogglingFieldsVisibilityToCurrentRegimentCheckbox = function(selector) {
                    const checkboxSelector = selector + ' > input[type=checkbox]';
                    const isCheckedSelector = checkboxSelector + ':checked';
                    const toggleInputVisibility = function() {
                        if ($(isCheckedSelector).length) {
                            $('#dateStoppedTd').hide();
                            $('#reasonStoppedTd').hide();
                        } else {
                            $('#dateStoppedTd').show();
                            $('#reasonStoppedTd').show();
                        }
                    }
                    $(checkboxSelector).click(() => toggleInputVisibility());
                }

                const addTogglingFieldsVisibilityToArtInterruptionsRadioButton = function() {
                    $('#radioDiv > input[type=radio]').click(function() {
                        if ($(this).val() === "true") {
                            $('#interruptionOptionsTrToHide').show();
                            $('#interruptionOptionsTrToHide').show();
                        } else if ($(this).val() === "false") {
                            $('#interruptionOptionsTrToHide').hide();
                            $('#interruptionOptionsTrToHide').hide();
                        }
                    });
                }

                const setARTInterruptionsHiddenByDefault = function() {
                    $('#interruptionOptionsDiv > input[type=radio]').prop("checked", true);
                    $('#interruptionOptionsTrToHide').hide();
                    $('#interruptionOptionsTrToHide').hide();
                }

                const handleNewArtFieldInEditModeOnChange = function(field) {
                    $('#' + field).change(function () {
                        var fieldValue = getValue(field + '.value');
                        var errorField = getField(field + '.error');
                        if (fieldValue == null || fieldValue == '') {
                            errorField.html("Required").show();
                            $('#' + field).parent().addClass("alignInput");
                        } else {
                            errorField.hide();
                            $('#' + field).parent().removeClass("alignInput");
                        }
                    })
                }

                //executions
                setCurrentRegimentActiveByDefault('#currentRegimenForNewArt');
                addTogglingFieldsVisibilityToCurrentRegimentCheckbox('#currentRegimenForNewArt');
                setARTInterruptionsHiddenByDefault();
                showActiveARTs();
                showOrHideAddInterruptionsButtons();
                addTogglingFieldsVisibilityToArtInterruptionsRadioButton();
                handleAccordionForARTDetails();
                handleAddNewArtButton();
                handleRemoveARTButtonClick();
                handleRemoveInterruptionClick();
                handleAddNewInterruptionButtonClick();
                handleAddNewInterruptionIfEmptyButtonClick();
                setTimeout(setBreadcrumbsUrl, 1000);
                handleTogglingCurrentRegimenCheckbox();

                for (var i = 1; i &lt; 11; i++) {
                    handleOnChange(i + '-ARTDateStarted');
                    handleOnChange(i + '-ARTDateStopped');
                    handleRegimenChange('#' + i + '-regimenSpan > h3 > select');
                    for (var j = 1; j &lt; 11; j++) {
                        handleOnChange(i + '-' + j + '-interruptionDate');
                    }
                }

                handleNewArtFieldInEditModeOnChange('artDateStartedInEditMode');
                handleNewArtFieldInEditModeOnChange('artDateStoppedInEditMode');
                handleRegimenChange('#regimenValue > select');
                handleNewArtFieldInEditModeOnChange('artInterruptionDateInEditMode');
            });
        </script>

        <div id="titleDiv">
            <h2 style="color: blue;">
                <uimessage code="HIV Program - Overview"/>
            </h2>
        </div>

        <div id="mainDiv">
            <table class="form-table" width="100%">
                <tr>
                    <td class="titleRowTd"><span><lookup expression="fn.getConcept('ddfdf4fa-1d0a-40ca-8930-ad914bd07b23').name"/></span></td>
                    <td class="titleRowTd"><span><lookup expression="fn.getConcept('806195ad-9f5c-42f0-ad9f-736a21a1dac1').name"/></span></td>
                    <td class="titleRowTd"><span><lookup expression="fn.getConcept('c7e17ce8-d832-4349-a326-b20f5ae7f432').name"/></span></td>
                    <td class="titleRowTd"><span><lookup expression="fn.getConcept('324f28ab-cfa7-46ac-99f3-c7d928ba5e79').name"/></span></td>
                    <td class="titleRowTd"><span></span></td>
                </tr>
            </table>
        </div>
        <div id="ARTsListDiv">
            <repeat>
                <template>
                    <div id="{n}-ART" style="display: none;">
                        <table id="{n}-ARTTable" class="artTableClass">
                            <obsgroup groupingConceptId="7e08e42b-744c-4a33-8a59-e0ec735ffd59">
                                <lookup expression="fn.getConcept('20fb8dc4-b958-4c88-b9a7-96ea36b4b0ef').name"/><obs id="{n}-currentRegimen" conceptId="20fb8dc4-b958-4c88-b9a7-96ea36b4b0ef" style="checkbox" class="currentRegimenCheckbox"/><b/>
                                <tr id="{n}-mainRowART" class="mainRowARTClass">
                                    <td class="headerRow"><span><h3><obs id="{n}-ARTDateStarted" conceptId="ddfdf4fa-1d0a-40ca-8930-ad914bd07b23"  class="customInput"/></h3></span></td>
                                    <td class="headerRow"><span><h3><obs id="{n}-ARTDateStopped" conceptId="806195ad-9f5c-42f0-ad9f-736a21a1dac1" class="customInput"/></h3></span></td>
                                    <td class="headerRow regimenTd"><span id="{n}-regimenSpan"><h3><regimen conceptId="c7e17ce8-d832-4349-a326-b20f5ae7f432" addNew="false" class="customInput"/></h3></span></td>
                                    <td class="headerRow"><span><h3><obs id="{n}-ARTType" conceptId="324f28ab-cfa7-46ac-99f3-c7d928ba5e79" class="customInput"/></h3></span></td>
                                    <td><span><div><input id="{n}-removeArtButton" class="removeArtButtonClass" type="button" value="X" title="Remove ART"/></div></span></td>
                                </tr>
                                <tr id="{n}-headerRowInterruption" style="display: none;">
                                    <td class="detailsRow"><span><lookup expression="fn.getConcept('dca99985-a303-4418-a440-d2af44f62c4b').name"/></span></td>
                                    <td class="detailsRow"><span><lookup expression="fn.getConcept('30d09891-6bae-492c-b45b-ebe142837497').name"/></span></td>
                                    <td class="detailsRow"><span><lookup expression="fn.getConcept('d9cd2810-d600-47c4-b29c-234c72514b9e').name"/></span></td>
                                </tr>
                                <tr id="{n}-1-mainRowInterruption" class="{n}-mainRowInterruptionClass" style="display: none;">
                                    <td class="detailsRow"><obs id="{n}-1-interruptionDate" conceptId="dca99985-a303-4418-a440-d2af44f62c4b"/></td>
                                    <td class="detailsRow"><obs id="{n}-1-interruptionReason" conceptId="30d09891-6bae-492c-b45b-ebe142837497"/></td>
                                    <td class="detailsRow"><obs id="{n}-1-interruptionRestartDate" conceptId="d9cd2810-d600-47c4-b29c-234c72514b9e"/></td>
                                    <td>
                                        <div style="display: flex;">
                                            <span><div><input id="{n}-1-addInterruptionButton" class="addNewInterruptionButtonClass" type="button" value="+" title="Add new interruption"/></div></span>
                                            <span><div><input id="{n}-1-removeInterruptionButton" class="removeInterruptionButtonClass" type="button" value="-" title="Remove interruption"/></div></span>
                                        </div>
                                    </td>
                                </tr>
                                <tr id="{n}-2-mainRowInterruption" class="{n}-mainRowInterruptionClass" style="display: none;">
                                    <td class="detailsRow"><obs id="{n}-2-interruptionDate" conceptId="dca99985-a303-4418-a440-d2af44f62c4b"/></td>
                                    <td class="detailsRow"><obs id="{n}-2-interruptionReason" conceptId="30d09891-6bae-492c-b45b-ebe142837497"/></td>
                                    <td class="detailsRow"><obs id="{n}-2-interruptionRestartDate" conceptId="d9cd2810-d600-47c4-b29c-234c72514b9e"/></td>
                                    <td>
                                        <div style="display: flex;">
                                            <span><div><input id="{n}-2-addInterruptionButton" class="addNewInterruptionButtonClass" type="button" value="+" title="Add new interruption"/></div></span>
                                            <span><div><input id="{n}-2-removeInterruptionButton" class="removeInterruptionButtonClass" type="button" value="-" title="Remove interruption"/></div></span>
                                        </div>
                                    </td>
                                </tr>
                                <tr id="{n}-3-mainRowInterruption" class="{n}-mainRowInterruptionClass" style="display: none;">
                                    <td class="detailsRow"><obs id="{n}-3-interruptionDate" conceptId="dca99985-a303-4418-a440-d2af44f62c4b"/></td>
                                    <td class="detailsRow"><obs id="{n}-3-interruptionReason" conceptId="30d09891-6bae-492c-b45b-ebe142837497"/></td>
                                    <td class="detailsRow"><obs id="{n}-3-interruptionRestartDate" conceptId="d9cd2810-d600-47c4-b29c-234c72514b9e"/></td>
                                    <td>
                                        <div style="display: flex;">
                                            <span><div><input id="{n}-3-addInterruptionButton" class="addNewInterruptionButtonClass" type="button" value="+" title="Add new interruption"/></div></span>
                                            <span><div><input id="{n}-3-removeInterruptionButton" class="removeInterruptionButtonClass" type="button" value="-" title="Remove interruption"/></div></span>
                                        </div>
                                    </td>
                                </tr>
                                <tr id="{n}-4-mainRowInterruption"  class="{n}-mainRowInterruptionClass" style="display: none;">
                                    <td class="detailsRow"><obs id="{n}-4-interruptionDate" conceptId="dca99985-a303-4418-a440-d2af44f62c4b"/></td>
                                    <td class="detailsRow"><obs id="{n}-4-interruptionReason" conceptId="30d09891-6bae-492c-b45b-ebe142837497"/></td>
                                    <td class="detailsRow"><obs id="{n}-4-interruptionRestartDate" conceptId="d9cd2810-d600-47c4-b29c-234c72514b9e"/></td>
                                    <td>
                                        <div style="display: flex;">
                                            <span><div><input id="{n}-4-addInterruptionButton" class="addNewInterruptionButtonClass" type="button" value="+" title="Add new interruption"/></div></span>
                                            <span><div><input id="{n}-4-removeInterruptionButton" class="removeInterruptionButtonClass" type="button" value="-" title="Remove interruption"/></div></span>
                                        </div>
                                    </td>
                                </tr>
                                <tr id="{n}-5-mainRowInterruption"  class="{n}-mainRowInterruptionClass" style="display: none;">
                                    <td class="detailsRow"><obs id="{n}-5-interruptionDate" conceptId="dca99985-a303-4418-a440-d2af44f62c4b"/></td>
                                    <td class="detailsRow"><obs id="{n}-5-interruptionReason" conceptId="30d09891-6bae-492c-b45b-ebe142837497"/></td>
                                    <td class="detailsRow"><obs id="{n}-5-interruptionRestartDate" conceptId="d9cd2810-d600-47c4-b29c-234c72514b9e"/></td>
                                    <td>
                                        <div style="display: flex;">
                                            <span><div><input id="{n}-5-addInterruptionButton" class="addNewInterruptionButtonClass" type="button" value="+" title="Add new interruption"/></div></span>
                                            <span><div><input id="{n}-5-removeInterruptionButton" class="removeInterruptionButtonClass" type="button" value="-" title="Remove interruption"/></div></span>
                                        </div>
                                    </td>
                                </tr>
                                <tr id="{n}-6-mainRowInterruption"  class="{n}-mainRowInterruptionClass" style="display: none;">
                                    <td class="detailsRow"><obs id="{n}-6-interruptionDate" conceptId="dca99985-a303-4418-a440-d2af44f62c4b"/></td>
                                    <td class="detailsRow"><obs id="{n}-6-interruptionReason" conceptId="30d09891-6bae-492c-b45b-ebe142837497"/></td>
                                    <td class="detailsRow"><obs id="{n}-6-interruptionRestartDate" conceptId="d9cd2810-d600-47c4-b29c-234c72514b9e"/></td>
                                    <td>
                                        <div style="display: flex;">
                                            <span><div><input id="{n}-6-addInterruptionButton" class="addNewInterruptionButtonClass" type="button" value="+" title="Add new interruption"/></div></span>
                                            <span><div><input id="{n}-6-removeInterruptionButton" class="removeInterruptionButtonClass" type="button" value="-" title="Remove interruption"/></div></span>
                                        </div>
                                    </td>
                                </tr>
                                <tr id="{n}-7-mainRowInterruption"  class="{n}-mainRowInterruptionClass" style="display: none;">
                                    <td class="detailsRow"><obs id="{n}-7-interruptionDate" conceptId="dca99985-a303-4418-a440-d2af44f62c4b"/></td>
                                    <td class="detailsRow"><obs id="{n}-7-interruptionReason" conceptId="30d09891-6bae-492c-b45b-ebe142837497"/></td>
                                    <td class="detailsRow"><obs id="{n}-7-interruptionRestartDate" conceptId="d9cd2810-d600-47c4-b29c-234c72514b9e"/></td>
                                    <td>
                                        <div style="display: flex;">
                                            <span><div><input id="{n}-7-addInterruptionButton" class="addNewInterruptionButtonClass" type="button" value="+" title="Add new interruption"/></div></span>
                                            <span><div><input id="{n}-7-removeInterruptionButton" class="removeInterruptionButtonClass" type="button" value="-" title="Remove interruption"/></div></span>
                                        </div>
                                    </td>
                                </tr>
                                <tr id="{n}-8-mainRowInterruption"  class="{n}-mainRowInterruptionClass" style="display: none;">
                                    <td class="detailsRow"><obs id="{n}-8-interruptionDate" conceptId="dca99985-a303-4418-a440-d2af44f62c4b"/></td>
                                    <td class="detailsRow"><obs id="{n}-8-interruptionReason" conceptId="30d09891-6bae-492c-b45b-ebe142837497"/></td>
                                    <td class="detailsRow"><obs id="{n}-8-interruptionRestartDate" conceptId="d9cd2810-d600-47c4-b29c-234c72514b9e"/></td>
                                    <td>
                                        <div style="display: flex;">
                                            <span><div><input id="{n}-8-addInterruptionButton" class="addNewInterruptionButtonClass" type="button" value="+" title="Add new interruption"/></div></span>
                                            <span><div><input id="{n}-8-removeInterruptionButton" class="removeInterruptionButtonClass" type="button" value="-" title="Remove interruption"/></div></span>
                                        </div>
                                    </td>
                                </tr>
                                <tr id="{n}-9-mainRowInterruption"  class="{n}-mainRowInterruptionClass" style="display: none;">
                                    <td class="detailsRow"><obs id="{n}-9-interruptionDate" conceptId="dca99985-a303-4418-a440-d2af44f62c4b"/></td>
                                    <td class="detailsRow"><obs id="{n}-9-interruptionReason" conceptId="30d09891-6bae-492c-b45b-ebe142837497"/></td>
                                    <td class="detailsRow"><obs id="{n}-9-interruptionRestartDate" conceptId="d9cd2810-d600-47c4-b29c-234c72514b9e"/></td>
                                    <td>
                                        <div style="display: flex;">
                                            <span><div><input id="{n}-9-addInterruptionButton" class="addNewInterruptionButtonClass" type="button" value="+" title="Add new interruption"/></div></span>
                                            <span><div><input id="{n}-9-removeInterruptionButton" class="removeInterruptionButtonClass" type="button" value="-" title="Remove interruption"/></div></span>
                                        </div>
                                    </td>
                                </tr>
                                <tr id="{n}-10-mainRowInterruption"  class="{n}-mainRowInterruptionClass" style="display: none;">
                                    <td class="detailsRow"><obs id="{n}-10-interruptionDate" conceptId="dca99985-a303-4418-a440-d2af44f62c4b"/></td>
                                    <td class="detailsRow"><obs id="{n}-10-interruptionReason" conceptId="30d09891-6bae-492c-b45b-ebe142837497"/></td>
                                    <td class="detailsRow"><obs id="{n}-10-interruptionRestartDate" conceptId="d9cd2810-d600-47c4-b29c-234c72514b9e"/></td>
                                    <td>
                                        <div style="display: flex;">
                                            <span><div><input id="{n}-10-addInterruptionButton" class="addNewInterruptionButtonClass" type="button" value="+" title="Add new interruption"/></div></span>
                                            <span><div><input id="{n}-10-removeInterruptionButton" class="removeInterruptionButtonClass" type="button" value="-" title="Remove interruption"/></div></span>
                                        </div>
                                    </td>
                                </tr>
                            </obsgroup>
                        </table>
                        <div id="{n}-noInterruptionsRow" style="display: none;" class="noInterruptionsClass">
                            <div>No interruptions</div>
                            <span><div><input id="{n}-addInterruptionButtonIfEmpty" class="addNewInterruptionButtonIfEmptyClass" type="button" value="+" title="Add new interruption"/></div></span>
                        </div>
                    </div>
                </template>

                <render n="1" />
                <render n="2" />
                <render n="3" />
                <render n="4" />
                <render n="5" />
                <render n="6" />
                <render n="7" />
                <render n="8" />
                <render n="9" />
                <render n="10" />
            </repeat>
        </div>

        <br></br>
        <br></br>

        <div>
            <input id="addNewArtButton" type="button" value="Add new ART"/>
        </div>

        <br></br>
        <br></br>
        <div id="addNewArtDiv" style="display:none;">

            <obsgroup groupingConceptId="7e08e42b-744c-4a33-8a59-e0ec735ffd59">
                <table>
                    <lookup expression="fn.getConcept('20fb8dc4-b958-4c88-b9a7-96ea36b4b0ef').name"/><obs id="currentRegimenForNewArt" conceptId="20fb8dc4-b958-4c88-b9a7-96ea36b4b0ef" style="checkbox"/><b/>
                    <tr>
                        <td class="datePickerField"><div><lookup expression="fn.getConcept('ddfdf4fa-1d0a-40ca-8930-ad914bd07b23').name"/><span style="color:red">*</span><br></br><obs id="artDateStartedInEditMode" conceptId="ddfdf4fa-1d0a-40ca-8930-ad914bd07b23" allowFutureDates="false" allowTime="false" defaultObsDatetime="now" class="customInput"/></div></td>
                        <td id="dateStoppedTd" class="datePickerField"><div><lookup expression="fn.getConcept('806195ad-9f5c-42f0-ad9f-736a21a1dac1').name"/><span style="color:red">*</span><br></br><obs id="artDateStoppedInEditMode" conceptId="806195ad-9f5c-42f0-ad9f-736a21a1dac1" allowFutureDates="false" allowTime="false" defaultObsDatetime="now" class="customInput"/></div></td>
                        <td id="reasonStoppedTd"><div><lookup expression="fn.getConcept('9c65e0a7-8c12-46d4-8ad2-da1aa37b8276').name"/><br></br><obs id="artReasonStoppedInEditMode" conceptId="9c65e0a7-8c12-46d4-8ad2-da1aa37b8276" defaultObsDatetime="now" class="customInput"/></div></td>
                    </tr>
                    <tr>
                        <td id="regimenValueTd"><div><span class="left"><lookup expression="fn.getConcept('c7e17ce8-d832-4349-a326-b20f5ae7f432').name"/></span><span style="color:red">*</span><br></br><span id="regimenValue"><regimen conceptId="c7e17ce8-d832-4349-a326-b20f5ae7f432" addNew="true" /></span></div></td>
                        <td><div><span class="left"><lookup expression="fn.getConcept('324f28ab-cfa7-46ac-99f3-c7d928ba5e79').name"/></span><br></br><obs conceptId="324f28ab-cfa7-46ac-99f3-c7d928ba5e79" defaultObsDatetime="now" /></div></td>
                    </tr>
                </table>


                <div id="regimenDetailsDiv" style="display: none;">
                    <div id="regimenDetailsHeaderDiv">
                        <table id="regimenDetailsHeaderTable">
                            <tr id="regimenDetailsHeaderTr">
                                <td class="regimenDetailsHeaderTd">Drug name</td>
                                <td class="regimenDetailsHeaderTd">Dose unit</td>
                                <td class="regimenDetailsHeaderTd">Number of units</td>
                                <td class="regimenDetailsHeaderTd">Frequency</td>
                            </tr>
                        </table>
                    </div>
                    <div>
                        <table id="regimenDetailsTable"></table>
                    </div>
                </div>

                <table>
                    <tr id="interruptionOptionsTr">
                        <td>
                            <div id="interruptionOptionsDiv">
                                <span class="left"><lookup expression="fn.getConcept('ecab0816-0f06-47cd-aa4d-68f428a26f3f').name"/></span>
                                <br></br>
                                <br></br>
                                <div id="radioDiv" style="display: flex;"><obs conceptId="ecab0816-0f06-47cd-aa4d-68f428a26f3f" style="yes_no" defaultObsDatetime="now" /></div>
                            </div>
                        </td>
                    </tr>
                    <tr id="interruptionOptionsTrToHide">
                        <td><div><span class="left"><lookup expression="fn.getConcept('dca99985-a303-4418-a440-d2af44f62c4b').name"/></span><span style="color:red">*</span><br></br><obs id="artInterruptionDateInEditMode" conceptId="dca99985-a303-4418-a440-d2af44f62c4b" allowFutureDates="false" allowTime="false" class="customInput"/></div></td>
                        <td><div><span class="left"><lookup expression="fn.getConcept('30d09891-6bae-492c-b45b-ebe142837497').name"/></span><br></br><obs conceptId="30d09891-6bae-492c-b45b-ebe142837497" class="customInput"/></div></td>
                        <td><div><span class="left"><lookup expression="fn.getConcept('d9cd2810-d600-47c4-b29c-234c72514b9e').name"/></span><br></br><obs conceptId="d9cd2810-d600-47c4-b29c-234c72514b9e" allowFutureDates="false" allowTime="false" class="customInput"/></div></td>
                    </tr>
                </table>
            </obsgroup>
        </div>
    </ifMode>

    <enrollInProgram programId="06c596e7-53dd-44c1-9609-f1406fd9e76d"/>

    <ifMode mode="VIEW" include="false">
        <div id="buttons">
            <submit submitClass="confirm right" submitCode="Save"/>
            <button id="cancelButton" type="button" class="cancel"><uimessage code="general.cancel"/></button>
        </div>
        <redirectOnSave url="/htmlformentryui/htmlform/editHtmlFormWithStandardUi.page?patientId={{patient.id}}&amp;encounterId={{encounter.id}}"/>
    </ifMode>
</htmlform>